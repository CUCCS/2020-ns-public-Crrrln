# å¸¸è§èœœç½ä½“éªŒå’Œæ¢ç´¢

## å®éªŒç›®çš„

- äº†è§£èœœç½çš„åˆ†ç±»å’ŒåŸºæœ¬åŸç†
- äº†è§£ä¸åŒç±»å‹èœœç½çš„é€‚ç”¨åœºåˆ
- æŒæ¡å¸¸è§èœœç½çš„æ­å»ºå’Œä½¿ç”¨

## å®éªŒè¦æ±‚

- [x] è®°å½•èœœç½çš„è¯¦ç»†æ­å»ºè¿‡ç¨‹ï¼›
- [x] ä½¿ç”¨ `nmap` æ‰«ææ­å»ºå¥½çš„èœœç½å¹¶åˆ†ææ‰«æç»“æœï¼ŒåŒæ—¶åˆ†æã€Œ `nmap` æ‰«ææœŸé—´ã€èœœç½ä¸Šè®°å½•å¾—åˆ°çš„ä¿¡æ¯ï¼›
- [x] å¦‚ä½•è¾¨åˆ«å½“å‰ç›®æ ‡æ˜¯ä¸€ä¸ªã€Œèœœç½ã€ï¼Ÿä»¥è‡ªå·±æ­å»ºçš„èœœç½ä¸ºä¾‹è¿›è¡Œè¯´æ˜ï¼›
- [x] ï¼ˆå¯é€‰ï¼‰æ€»ç»“å¸¸è§çš„èœœç½è¯†åˆ«å’Œæ£€æµ‹æ–¹æ³•ï¼›
- [x] ï¼ˆå¯é€‰ï¼‰å°è¯•åŸºäº [canarytokens](https://github.com/thinkst/canarytokens) æ­å»ºèœœä¿¡å®éªŒç¯å¢ƒè¿›è¡Œè‡ªç”±æ¢ç´¢å‹å®éªŒï¼›



## å®éªŒç¯å¢ƒ

- ä» [paralax/awesome-honeypots](https://github.com/paralax/awesome-honeypots) ä¸­é€‰æ‹© 1 ç§ä½äº¤äº’èœœç½å’Œ 1 ç§ä¸­ç­‰äº¤äº’èœœç½è¿›è¡Œæ­å»ºå®éªŒ
  - ä½äº¤äº’èœœç½
    - ssh-honeypot 0.1.0
  - ä¸­ç­‰äº¤äº’èœœç½
    - Cowrie 2.2.0
- Kali Rolling 2020.3
- docker 20.10.0

![](./img/ifconfig.PNG)

#### **ç½‘ç»œæ‹“æ‰‘**

![](./img/ip1.PNG)

#### **ç½‘ç»œè¿é€šæ€§æµ‹è¯•**



![](./img/ç½‘ç»œè¿é€šæ€§.PNG)





## å®éªŒè¿‡ç¨‹

### ä½äº¤äº’èœœç½ ssh-honeypot



#### **1.é€‰æ‹©åŸå› **

- å¯ç›‘å¬sshè¿æ¥æ—¶ä½¿ç”¨çš„IPåœ°å€ï¼Œç”¨æˆ·åå’Œ**å¯†ç **

- æ”¯æŒdockerå®‰è£…

#### **2.æ­å»ºè¿‡ç¨‹**

**å®‰è£…docker**

```bash
#å®‰è£…httpsåè®®ã€CAè¯ä¹¦ã€dirmngr
apt-get update 
apt-get install -y apt-transport-https ca-certificates
apt-get install dirmngr

#æ·»åŠ GPGå¯†é’¥å¹¶æ·»åŠ æ›´æ–°æº
curl -fsSL https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian/gpg | sudo apt-key add -
echo 'deb https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian/ buster stable' | sudo tee /etc/apt/sources.list.d/docker.list

#ç³»ç»Ÿæ›´æ–°ä»¥åŠå®‰è£…docker
apt-get update
apt install docker-ce

#å¯åŠ¨dockeræœåŠ¡å™¨
service docker start

#å®‰è£…compose
apt install docker-compose

#dockerå®‰è£…æµ‹è¯•(hello-world)
docker run hello-world
```

![](./img/hello-world.PNG)

```bash
#æŸ¥çœ‹dockerç‰ˆæœ¬
docker --version

#æŸ¥çœ‹dockeré•œåƒ
docker images

#åˆ—å‡ºå®¹å™¨
docker ps
```

![](./img/dockerä¿¡æ¯.PNG)

**å®‰è£…ssh**

```bash
#å…‹éš†ä»“åº“
git clone https://github.com/droberson/ssh-honeypot.git

#åˆ‡æ¢ç›®å½•
cd ssh-honeypot

#æ„å»ºè¿è¡Œç¯å¢ƒ
make

#ç”Ÿæˆå…¬ç§é’¥å¯¹
ssh-keygen -t rsa -f ./ssh-honeypot.rsa
```

![](./img/ssh.PNG)

 **dockerå®‰è£…ssh-honeypot**

```bash
#åˆ‡æ¢æ–‡ä»¶å¤¹
cd docker

#build
docker-compose build

#run
docker-compose -p ssh-honeypot up
```


![](./img/æˆåŠŸå®‰è£…ssh-honey.PNG)



#### 3.ä½¿ç”¨`nmap`æ‰«æ

```bash
#å‡æ— å“åº”
nmap 10.0.2.15
nmap -sT -P 2222 -n -vv 10.0.2.15
nmap -sV -P 2222 -n -vv 10.0.2.15
nmap -sX -p 2222 -n -vv 10.0.2.15
nmap -sS -P 2222 -n -vv 10.0.2.15
nmap -sn -P 2222 -n -vv 10.0.2.15
```

æ­¤å¤„æˆªå›¾ä¸ä¸€ä¸€åˆ—ä¸¾

å‘ç°`nmap`æ‰«ææ— è®°å½•ï¼Œæœç„¶æ˜¯ä¸ªä½äº¤äº’èœœç½...

![](./img/nmapæ— å“åº”.PNG)



#### 4.å¯¹èœœç½çš„è¾¨åˆ«



å…ˆsshç™»é™†ä¸€æ³¢

![](./img/sshè¿ä¸ä¸Š.PNG)

ä¸ä¼šå§ä¸ä¼šå§ï¼Œrootå’Œæ™®é€šç”¨æˆ·éƒ½è¿æ¥ä¸ä¸ŠğŸ˜…ä½†æ˜¯æ”»å‡»è€…çš„IPåœ°å€ï¼Œç”¨æˆ·åå’Œå¯†ç å¯ä»¥å…¨éƒ¨æ˜¾ç¤ºğŸ‘



**æ€»ç»“**

ssh-honeypotæ˜¯ä¸€ä¸ªæç®€ä½äº¤äº’èœœç½

Pros

- å¯ä»¥æŸ¥çœ‹æ”»å‡»è€…ip,ç”¨æˆ·ååŠå¯†ç 

Cons

- æ— æ³•ç™»å½•å»ºç«‹è¿æ¥ï¼ˆè¿™ä¸æ˜¯è®©æ”»å‡»è€…ä¸€ç§’è¯†ç ´å—..
- åŠŸèƒ½å¤ªå°‘

### ä¸­ç­‰äº¤äº’èœœç½ Cowrie

#### **1.é€‰æ‹©åŸå› **

- å®‰è£…è¿‡ç¨‹æç®€å•
- æœ‰[å®˜æ–¹æ–‡æ¡£](https://cowrie.readthedocs.io/en/latest/)ï¼Œæ–¹ä¾¿è§£å†³é—®é¢˜
- githubä¸€ç›´åœ¨ç»´æŠ¤æ›´æ–°

#### **2.æ­å»ºè¿‡ç¨‹**

```bash
#ä¸‹è½½é•œåƒ
docker pull cowrie/cowrie

#è¿è¡Œé•œåƒ
docker run -p 2222:2222 cowrie/cowrie
```

![](./img/cowieæ‹‰å–å’Œè¿è¡Œ.PNG)

#### 3.ä½¿ç”¨`nmap`æ‰«æ

```bash
#æœ‰å“åº”
nmap -sT -P 2222 -n -vv 10.0.2.15
nmap -sV -P 2222 -n -vv 10.0.2.15

#æ— å“åº”
nmap 10.0.2.15
nmap -sX -p 2222 -n -vv 10.0.2.15
nmap -sS -P 2222 -n -vv 10.0.2.15
nmap -sN -P 2222 -n -vv 10.0.2.15
```



![](./img/crowie-nmap.PNG)

æ­¤å¤„å¯¹å›¾ç‰‡ä¸è¿›è¡Œä¸€ä¸€åˆ—ä¸¾ï¼Œä¸­ç­‰äº¤äº’èœœç½ç¡®å®æ¯”ä½äº¤äº’èœœç½åšå¾—è¦å®Œå–„ä¸€äº›

#### 4.å¯¹èœœç½çš„è¾¨åˆ«

**sshç™»å½•**



![](./img/crowieç™»å½•æµ‹è¯•.PNG)

ç»“æœçœ‹æ¥åªæœ‰rootç”¨æˆ·å¯ä»¥ç™»å½•ï¼Œå…¶ä»–ç”¨æˆ·éƒ½æ— æ³•ç™»å½•



**å¸¸è§å‘½ä»¤æµ‹è¯•**

```bash
#å‘½ä»¤å¦‚ä¸‹
ps aux
cat /etc/issue
lsb_release -a
ping www.baidu.com
```



![](./img/ä¸€éƒ¨åˆ†å‘½ä»¤.PNG)

å…¶ä¸­ï¼Œé™¤äº†æŸ¥çœ‹å‘è¡Œç‰ˆæœ¬`lsb_release -a`éœ²å‡ºç ´ç»½ï¼Œå…¶ä»–çœ‹èµ·æ¥è¿˜éƒ½ok

ä¸­é—´æœ‰ä¸€æ¬¡èœœç½è‡ªåŠ¨æ–­å¼€äº†è¿æ¥...å¯èƒ½æ˜¯å‡ºäºè‡ªæˆ‘ä¿æŠ¤ï¼ˆç ´ç»½2

![](./img/è¿æ¥è‡ªåŠ¨æ–­å¼€.PNG)

ç»§ç»­å‘½ä»¤æµ‹è¯•

```bash
#å‘½ä»¤å¦‚ä¸‹
curl www.baidu.com
wget http://www.cuc.edu.cn -O cuc.html
cat cuc.html
```

![](./img/curl.PNG)

![](./img/wgetå¯¹æ¯”.PNG)

çœ‹èµ·æ¥curlæŒ‡ä»¤æ˜¯æ­£å¸¸çš„ï¼ŒwgetæŒ‡ä»¤ä¹Ÿæœ‰äº†ç ´ç»½ï¼ŸğŸ˜†ï¼ˆç ´ç»½3



è¯•ä¸€è¯•å®‰è£…

![](./img/å‡å®‰è£….PNG)

æŸ¥çœ‹pythonç‰ˆæœ¬

![](./img/æŸ¥çœ‹pythonç‰ˆæœ¬.PNG)

è¯•å›¾ä¿®æ”¹æ–‡ä»¶

![](./img/å‡å®‰è£…2.PNG)

viç”¨ä¸äº†ï¼Œvimæ²¡æœ‰ï¼Œæˆ‘å»æŸ¥äº†æŸ¥`terminal entry not found in terminfo`çš„æŠ¥é”™ï¼Œå¤§æ¦‚æ„æ€æ˜¯/lib/terminfo æˆ– /usr/share/terminfo ç›®å½•ä¸‹æ²¡æœ‰ç»ˆç«¯å…¥å£ï¼Œä½†æ˜¯å®‰è£…äº†vimä¹‹åä¹Ÿå¾ˆå‡ï¼ˆæé—®ï¼šè¿™é‡Œçš„viç®—ç ´ç»½å—ğŸ‘€



å°è¯•æŸ¥çœ‹æ–‡ä»¶

![](./img/æ²¡æœ‰æºæ–‡ä»¶.PNG)

![](./img/æ— logæ–‡ä»¶.PNG)

åªæŒ‚äº†ä¸ªåï¼Œå¹¶æ²¡æœ‰å®é™…çš„æ–‡ä»¶ï¼ŒçœŸä¸é”™ï¼Œè¿™æ‹›åä¸ºâ€œæ˜ä¿®æ ˆé“,æš—æ¸¡é™ˆä»“â€ï¼Œè™šå¼ å£°åŠ¿ç½¢äº†ğŸ¤£



**æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶**

è¿™ä¸€ç³»åˆ—è¡Œä¸ºéƒ½è¢«è®°å½•åœ¨æ—¥å¿—ä¸­

```bash
#æŸ¥çœ‹docker id
docker ps

#å°†æ—¥å¿—å¤åˆ¶åˆ°æœ¬åœ°æŸ¥çœ‹
docker cp container_id:/cowrie/cowrie-git/var/log/cowrie ~

#è¿›å…¥æ–‡ä»¶å¤¹
cd cowrie

#æŸ¥çœ‹Logæ–‡ä»¶
cat cowrie.json | jq .
```

![](./img/æŸ¥çœ‹log.PNG)

**æ€»ç»“**

Pros

- åŠŸèƒ½å¾ˆå®Œå¤‡ï¼Œping, curlç­‰æŒ‡ä»¤æ˜¾ç¤ºæ— å¼‚å¸¸
- æœ‰Tabçš„è‡ªåŠ¨è¡¥å…¨

Cons

- æ¯æ¬¡é‡æ–°ç™»å½•rootç”¨æˆ·ï¼Œæ— æ³•ä¸Šä¸‹ç¿»åŠ¨è®°å½•
- ä¸€æ®µæ—¶é—´ä¼šè‡ªåŠ¨æ–­å¼€è¿æ¥ï¼ˆ~~è¿™ä¸æ˜¯æ­¤åœ°æ— é“¶ä¸‰ç™¾ä¸¤å—..~~
- æ— æ³•ç¼–è¾‘ä¿®æ”¹æ–‡ä»¶
- å‡å®‰è£…

### å¸¸è§çš„èœœç½è¯†åˆ«å’Œæ£€æµ‹æ–¹æ³•

- å¸¸è¯†å’Œç»éªŒå¾ˆé‡è¦ï¼ˆå¤šå°è¯•ä¸€äº›æŒ‡ä»¤å¹¶æ³¨æ„è§‚å¯Ÿç»†èŠ‚ï¼‰
- é‡è¦ä¿¡æ¯è¢«è½»æ˜“çš„è·å–è¦å°å¿ƒå¯èƒ½æ˜¯èœœç½ï¼Œæ¯”å¦‚è¯¥ç«™ç‚¹æœ‰å¾ˆå¤šå¼€æ”¾çš„ç«¯å£ï¼Œè¿™äº›ç«¯å£å¸¦æœ‰æ˜“å—æ”»å‡»çš„æœåŠ¡
- ç›®æ ‡æ˜¯å¦æœ‰å®Œå–„çš„ä¿¡æ¯æµï¼Œå¦‚æœæ²¡æœ‰ç»å¸¸çš„äº¤äº’/ç™»å½•ç­‰åŠ¨æ€ä¿¡æ¯ï¼Œè¿™æ ·çš„ç¯å¢ƒå°±å¾ˆå¯ç–‘
- å¯¹ç½‘ç»œç‰¹å¾è¿›è¡Œè¯†åˆ«ï¼Œå¦‚ç½‘ç»œæµé‡ã€æ•°æ®åŒ…å†…å®¹ã€TCP/IPåè®®æ ˆã€ç½‘ç»œå»¶è¿Ÿç­‰
- æŸ¥çœ‹è¾“å‡ºä¿¡æ¯ï¼Œæ˜¯å¦æœ‰æ¼æŠ¥æˆ–è¯¯æŠ¥ç­‰ç ´ç»½
- ä½¿ç”¨ç°æœ‰çš„èœœç½æ£€æµ‹å·¥å…·ï¼Œå¦‚[Checkpot](https://github.com/honeynet/checkpot)

### canarytokensèœœä¿¡å®éªŒ

æ›´æ”¹ç½‘ç»œæ‹“æ‰‘

![](./img/ç½‘ç»œæ‹“æ‰‘2.PNG)

ç½‘ç»œè¿é€šæ€§æµ‹è¯•

![](./img/ç½‘ç»œè¿é€šæ€§2.PNG)



**1.æ­å»ºè¿‡ç¨‹**



```bash
#å…‹éš†ä»“åº“
git clone https://github.com/thinkst/canarytokens-docker

#åˆ‡æ¢æ–‡ä»¶å¤¹
cd canarytokens-docker

#å®‰è£…ä¾èµ–åŒ…åŠdocker-compose
sudo apt-get install python-pip python-dev
sudo pip install -U docker-compose
#if this breaks with PyYAML errors, install the libyaml development package
# sudo apt-get install libyaml-dev

#ä¿®æ”¹frontend.envé…ç½®æ–‡ä»¶
#ä¿®æ”¹å†…å®¹å¦‚ä¸‹
CANARY_DOMAINS=172.16.111.144
```



å¯åŠ¨canarytokens

![](./img/å¯åŠ¨canarytoken.PNG)



ç™»å½•å¹¶åˆ›å»ºä¸€ä¸ªURL token

![](./img/ç™»å½•canarytoken.PNG)

æ”»å‡»è€…è®¿é—®ç”Ÿæˆçš„token

![](./img/æ”»å‡»è€…è®¿é—®.PNG)

å‘ç°è®¿é—®å·²è¢«è®°å½•

![](./img/æœ‰è®¿é—®è®°å½•.PNG)

æŸ¥çœ‹è®°å½•å‘ç°æ”»å‡»è€…çš„ip, è®¿é—®æ—¶é—´ï¼Œè®¿é—®ç”¨çš„æµè§ˆå™¨ç­‰å·²è¢«å…¨éƒ¨è®°å½•

![](./img/é¡µé¢.PNG)

æš´éœ²çš„å½»å½»åº•åº•ğŸ¤£

![](./img/è®¿é—®ä¿¡æ¯è¢«è®°å½•.PNG)

é€šè¿‡ipip.netæŸ¥è¯¢ipåœ°å€

![](./img/ipipnet.PNG)

## é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ³•

1.åœ¨Cowrieå®éªŒä¸­ï¼Œsshå†æ¬¡å»ºç«‹è¿æ¥æ—¶ç™»å½•æŠ¥é”™

![](./img/sshç™»å½•æŠ¥é”™.PNG)

è§£å†³ï¼šå°†åŸæ¥çš„å…¬é’¥ç§»é™¤

æ‰§è¡Œ`ssh-keygen -f "/root/.ssh/known_hosts" -R "[10.0.2.15]:2222"`å³å¯



2.åœ¨canarytokenå®éªŒä¸­ï¼Œnginxæ— æ³•å¯ç”¨ï¼Œ80ç«¯å£è¢«å ç”¨

![](./img/80ç«¯å£è¢«å ç”¨.PNG)



è§£å†³ï¼šå°†apacheå¸è½½å³å¯



3.åœ¨canarytokenå®éªŒä¸­ï¼Œæ”»å‡»è€…è®¿é—®ç‰¹å®šURLåï¼Œé˜²å¾¡æ–¹å¹¶æ²¡æ”¶åˆ°é‚®ä»¶ï¼Ÿï¼ŸğŸ‘€

åœ¨ä¸»æœºä¸Šç™»å½•å®˜ç½‘å¹¶ç”Ÿæˆäº†ä¸€ä¸ªPDF tokenåï¼Œç‚¹å‡»PDFæ˜¯æœ‰é‚®ä»¶æç¤ºçš„...

![](./img/æ²¡æ”¶åˆ°é‚®ç®±.PNG)

é‚®ä»¶å†…å®¹ä¸º

![](./img/æ²¡æœ‰å‘é€æ­£ç¡®é‚®ç®±çš„ç–‘é—®.PNG)

## å‚è€ƒæ–‡çŒ®

[2019-NS-Public-chencwx](https://github.com/CUCCS/2019-NS-Public-chencwx/tree/ns_chap0x11/ns_chapter11)

[kaliå®‰è£…dockerç¯å¢ƒ](https://zhuanlan.zhihu.com/p/82361096)

[ç¬¬åä¸€ç« è§†é¢‘](https://www.bilibili.com/video/BV1Nr4y1c7TT?from=search&seid=11542271424244158717)

[ssh-honeypot](https://github.com/droberson/ssh-honeypot)

[Terminal entry not found in terminfo](https://www.phpfans.net/ask/fansa1/5658918625.html)

[cowrie](https://github.com/cowrie/cowrie)

[canarytokens-docker](https://github.com/thinkst/canarytokens-docker)

[how-to-detect-a-honeypot](https://www.ethicalhacker.net/forums/topic/how-to-detect-a-honeypot/)

[å¦‚ä½•åˆ¤æ–­æ˜¯ä¸æ˜¯è¿›å…¥äº†èœœç½ï¼Ÿ](https://www.zhihu.com/question/31213254)

[åŸºäºèœœç½ç‰¹å¾çš„èœœç½è¯†åˆ«æŠ€æœ¯](https://kns.cnki.net/KXReader/Detail?TIMESTAMP=637434021328885000&DBCODE=CJFD&TABLEName=CJFD2009&FileName=XDDJ200915030&RESULT=1&SIGN=kSKoER6zYOH8aS8t4z90hufcKYw%3d)





