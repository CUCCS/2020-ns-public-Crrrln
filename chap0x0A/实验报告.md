

# åº”ç”¨ç¨‹åºå®‰å…¨åŠ å›º

## å®éªŒç›®çš„

- ä½¿ç”¨fail2banå®ç°sshå®‰å…¨åŠ å›º

## å®éªŒç¯å¢ƒ

- Fail2Ban v0.11.1
- Kali Rolling 2020.3

**ç½‘ç»œæ‹“æ‰‘ç»“æ„**

![](./img/ç½‘ç»œæ‹“æ‰‘.PNG)



**ç½‘ç»œè¿é€šæ€§æµ‹è¯•**



![](C:\Users\thinker\Desktop\2020-ns-public-Crrrln\chap0x0A\img\pingé€š.PNG)







## å®éªŒè¿‡ç¨‹

**1.ç™»å½•ssh**

```bash
#å¯åŠ¨sshæœåŠ¡
systemctl start ssh

#ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå…è®¸rootç”¨æˆ·ä½¿ç”¨sshç™»å½•
vim /etc/ssh/sshd_config
#ä¿®æ”¹å†…å®¹
PermitRootLogin	yes		  

#é‡å¯sshæœåŠ¡
systemctl restart ssh
```



![](./img/permitrootlogin.PNG)

```bash
#è¿œç¨‹ç™»å½•
ssh root@10.0.2.15
```



![](./img/è¿œç¨‹ç™»å½•æˆåŠŸ.PNG)

çˆ†ç ´ssh

```bash
#è§£å‹çˆ†ç ´å­—å…¸
gzip -d /usr/share/wordlists/rockyou.txt.gz

#çˆ†ç ´å·¥å…·hydra
hydra -l root -P /usr/share/wordlists/rockyou.txt -v 10.0.2.15 ssh
```



![](./img/çˆ†ç ´æˆåŠŸ.PNG)



#### 2.ç»ƒä¹ ä½¿ç”¨fail2ban



```bash
#å®‰è£…fail2ban
apt-get update && apt-get install fail2ban

#æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ
fail2ban-client -h

#å¯åŠ¨ fail2ban
fail2ban-client start
```

![](./img/fail2banå¯åŠ¨.PNG)

é…ç½®jail.localæ–‡ä»¶

```bash
 #åœ¨kali-2ä¸»æœºæ“ä½œ
 #å¤‡ä»½
 cp /etc/fail2ban/fail2ban.conf /etc/fail2ban/jail.local
 
 #ä¿®æ”¹é…ç½®æ–‡ä»¶/etc/fail2ban/jail.local
 #æ·»åŠ å¦‚ä¸‹å†…å®¹
 [sshd]
 enabled = true
 
 #é‡å¯fail2ban
fail2ban-client restart
```

![](./img/ä¿®æ”¹é…ç½®æ–‡ä»¶.PNG)

```bash
 #åœ¨kali-1ä¸»æœºæ“ä½œ
 #è¿›è¡Œçˆ†ç ´
 hydra -l root -P /usr/share/wordlists/rockyou.txt -v 10.0.2.15 ssh
 
 #æ­¤æ—¶æŸ¥çœ‹kali-2ä¸­fail2banæ—¥å¿—/var/log/auth.log
tail -f /var/log/auth.log
```

å‘ç°æ— æ³•çˆ†ç ´å¯†ç ï¼Œä¸”æ— æ³•é€šè¿‡sshç™»å½•è®¿é—®

![](./img/banç»“æœ.PNG)

```bash
# é€šè¿‡é˜²ç«å¢™ä¹Ÿå¯ä»¥æŸ¥çœ‹åˆ°è¢«ç¦æ­¢çš„ip
iptables -L -n
```



![](./img/é˜²ç«å¢™.PNG)

ç”±äºé»˜è®¤ç¦æ­¢æ—¶é—´æ˜¯10min, æ•…10minåè§„åˆ™è¢«æ¸…é™¤

![](./img/é»‘åå•æ¸…é™¤.PNG)

æ­¤æ—¶fail2banä¼šè®°å½•æ›¾ç¦æ­¢è¿‡ipçš„æ•°ç›®ï¼Œä½†æ˜¯æ­¤æ—¶å¹¶ä¸åœ¨Banned IP listä¸Š

![](./img/banlistä¸æ˜¾ç¤º.PNG)



## é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ³•

1.aptè¢«å ç”¨

åœ¨å®‰è£…fail2bançš„æ—¶å€™ï¼Œè¿‡ç¨‹å¡äº†å¥½ä¹…ï¼Œæˆ‘å°±ç»™åœäº†ï¼Œåœäº†ä¹‹åå†æ‰§è¡Œå®‰è£…å‘½ä»¤å°±æŠ¥é”™äº†ï¼ˆå¤ªæ²¡è€å¿ƒäº†ğŸ˜…

![](./img/aptè¢«å ç”¨.PNG)

è§£å†³ï¼š

æœ¬æ¥æ‰“ç®—å°†apt-getè¿›ç¨‹ç»“æŸå°±å¥½ï¼Œä½†æ˜¯å‘ç°apt-getè¿›ç¨‹ä¸èƒ½å…¨éƒ¨æ€æ‰ï¼Œæ•…é‡å¯åæ‰§è¡Œ`sudo dpkg --configure -a`

![ ](./img/ç»“æŸè¿›ç¨‹.PNG)



2.fail2banæ— æ³•å¯åŠ¨



![](./img/fail2banæ— æ³•å¼€å¯.PNG)



è§£å†³ï¼š`sudo su`å†æ‰§è¡Œå‘½ä»¤å³å¯




## å‚è€ƒæ–‡çŒ®

[how-to-show-all-banned-ip-with-fail2ban](https://serverfault.com/questions/841183/how-to-show-all-banned-ip-with-fail2ban)

[fail2ban-will-not-start](https://stackoverflow.com/questions/24451393/fail2ban-will-not-start)

[using-fail2ban-to-secure-your-server-a-tutorial](https://www.linode.com/docs/guides/using-fail2ban-to-secure-your-server-a-tutorial/)





